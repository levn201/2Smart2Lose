 @page
@model KahootTransnetBW.Pages._1Viewer.PlaygroundModel
@{
    ViewData["Title"] = "Kahoot | Geb dein Bestes :D";
}

<link rel="stylesheet" href="~/css/Playground/GrundViewer.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/Playground/Playground.css" asp-append-version="true" />

<header class="header">
    <div class="logo">TRANS<span>NET</span> BW</div>
    <nav class="nav-links">
        <a href="/Index">Quit</a>
    </nav>
</header>


<!-- Test bereich -->
<h3> @Model.UserName </h3>

<form method="post">
    <input type="hidden" asp-for="CurrentOffset" />
    <input type="hidden" asp-for="GamePin" />

    <!-- Test anzeigen -->
    <div class="quiz-info">
        <p>Frage @(Model.CurrentOffset + 1) von @Model.QuestionCount</p>
        <p>Punkte: @Model.PlayerPoints</p>
    </div>

    <!-- fragen Cards werden rein geladen mit Checkboxen  -->
    @if (Model.FragenChecken.Any())
    {
        var frage = Model.FragenChecken.First();

        <div class="frage-block">

            <h3>@frage.DB_Fragestellung</h3>

            <!-- Antworten und Fragen Cards -->
            <div class="antwort-grid">

                <div class="antwort-card bg-1 @(Model.AnswerChecked ? (frage.DB_IstAntwort1Richtig ? "correct-answer" : (Model.UserAnswer.C_IstAntwort1Richtig ? "wrong-answer" : "")) : "")"
                     onclick="@(Model.AnswerChecked ? "" : "selectAnswer(this)")">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort1Richtig"
                           onchange="updateSelection(this)"
                           disabled="@Model.AnswerChecked" />
                    <label>@frage.DB_Antwort1</label>
                </div>

                <div class="antwort-card bg-2 @(Model.AnswerChecked ? (frage.DB_IstAntwort2Richtig ? "correct-answer" : (Model.UserAnswer.C_IstAntwort2Richtig ? "wrong-answer" : "")) : "")"
                     onclick="@(Model.AnswerChecked ? "" : "selectAnswer(this)")">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort2Richtig"
                           onchange="updateSelection(this)"
                           disabled="@Model.AnswerChecked" />
                    <label>@frage.DB_Antwort2</label>
                </div>

                <div class="antwort-card bg-3 @(Model.AnswerChecked ? (frage.DB_IstAntwort3Richtig ? "correct-answer" : (Model.UserAnswer.C_IstAntwort3Richtig ? "wrong-answer" : "")) : "")"
                     onclick="@(Model.AnswerChecked ? "" : "selectAnswer(this)")">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort3Richtig"
                           onchange="updateSelection(this)"
                           disabled="@Model.AnswerChecked" />
                    <label>@frage.DB_Antwort3</label>
                </div>

                <div class="antwort-card bg-4 @(Model.AnswerChecked ? (frage.DB_IstAntwort4Richtig ? "correct-answer" : (Model.UserAnswer.C_IstAntwort4Richtig ? "wrong-answer" : "")) : "")"
                     onclick="@(Model.AnswerChecked ? "" : "selectAnswer(this)")">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort4Richtig"
                           onchange="updateSelection(this)"
                           disabled="@Model.AnswerChecked" />
                    <label>@frage.DB_Antwort4</label>
                </div>
            </div>
        </div>
    }


    <!-- Butten unter den Antworten -->
    <div class="quiz-controls">

        @if (!Model.AnswerChecked)
        {
            <!-- Antwort Prüfen Button -->
            <button type="submit" asp-page-handler="CheckAnswer" class="btn btn-primary">
                Antwort Prüfen
            </button>
        }
        else
        {
            <!-- Nächste Frage Button -->
            @if (Model.CurrentOffset + 1 < Model.HowManyQuestions())
            {
                <button type="submit" asp-page-handler="NextQuestion" class="btn btn-success">
                    Nächste Frage
                </button>
            }

            <!-- Quiz Beenden Button -->
            @if (Model.CurrentOffset + 1 == Model.HowManyQuestions())
            {
                <button type="submit" asp-page-handler="FinishQuiz" class="btn btn-danger">
                    Quiz Beenden
                </button>
            }
        }

    </div>
</form>








































<!-- Für den CHeck mit Hintergrund ob die Antwort richtig ist oder nicht -->
<script>
    function selectAnswer(cardElement) {
        const allCheckboxes = document.querySelectorAll('.checkmark');
        const allCards = document.querySelectorAll('.antwort-card');

        allCards.forEach(card => card.classList.remove('selected'));
        allCheckboxes.forEach(cb => cb.checked = false);

        const currentCheckbox = cardElement.querySelector('.checkmark');
        currentCheckbox.checked = true;
        cardElement.classList.add('selected');
    }

    function updateSelection(checkbox) {
        const card = checkbox.closest('.antwort-card');

        if (checkbox.checked) {
            document.querySelectorAll('.checkmark').forEach(cb => {
                if (cb !== checkbox) cb.checked = false;
            });

            document.querySelectorAll('.antwort-card').forEach(c => {
                if (c !== card) c.classList.remove('selected');
            });

            card.classList.add('selected');
        } else {
            card.classList.remove('selected');
        }
    }

    document.querySelectorAll('.checkmark').forEach(cb => {
        cb.addEventListener('click', e => e.stopPropagation());
    });
</script>

<style>
    .correct-answer {
        background-color: #28a745 !important;
        color: white;
        border: 3px solid #1e7e34;
    }

    .wrong-answer {
        background-color: #dc3545 !important;
        color: white;
        border: 3px solid #bd2130;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border: 1px solid #c3e6cb;
    }

    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border: 1px solid #f5c6cb;
    }
</style>