@page
@model KahootTransnetBW.Pages._1Viewer.PlaygroundModel
@{
    ViewData["Title"] = "Kahoot | Geb dein Bestes :D";
}

<link rel="stylesheet" href="~/css/Playground/GrundViewer.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/Playground/Playground.css" asp-append-version="true" />

<header class="header">
    <div class="logo">TRANS<span>NET</span> BW</div>
    <nav class="nav-links">
        <a href="/Index">Quit</a>
    </nav>
</header>
a
<h2>Fragen aus der Datenbank</h2>

<form method="post">
    <input type="hidden" asp-for="CurrentOffset" />
    <input type="hidden" asp-for="GamePin" />

    <!-- Wie viele Fragen -->
    <div class="quiz-info">
        <p>Frage @(Model.CurrentOffset + 1) von @Model.QuestionCount</p>
    </div>

    <div class="error-message">@Model.ErrorMessage</div>

    <div class="success-message">@Model.SuccessMessage</div>

    <p id="">Fragen ID: @Model.GamePin</p>

    @if (Model.FragenChecken.Any())
    {
        var frage = Model.FragenChecken.First();

        <div class="frage-block">

            <h3>@frage.DB_Fragestellung</h3>

            <!-- Vierecke mit clickern -->
            <div class="antwort-grid">
                <div class="antwort-card bg-1" onclick="selectAnswer(this)">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort1Richtig"
                           onchange="updateSelection(this)" />
                    <label>@frage.DB_Antwort1</label>
                </div>
                <div class="antwort-card bg-2" onclick="selectAnswer(this)">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort2Richtig"
                           onchange="updateSelection(this)" />
                    <label>@frage.DB_Antwort2</label>
                </div>
                <div class="antwort-card bg-3" onclick="selectAnswer(this)">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort3Richtig"
                           onchange="updateSelection(this)" />
                    <label>@frage.DB_Antwort3</label>
                </div>
                <div class="antwort-card bg-4" onclick="selectAnswer(this)">
                    <input type="checkbox" class="checkmark"
                           asp-for="UserAnswer.C_IstAntwort4Richtig"
                           onchange="updateSelection(this)" />
                    <label>@frage.DB_Antwort4</label>
                </div>
            </div>
        </div>
    }


    <!-- Fragebereich -->
    <div class="quiz-controls">

        <!--
            Button Prüfen soll da sein, nach dem Prüfen kann man zur nächsten Frage
            Button Nächste Frage soll wenn geprüft wurde kommen
            Button Beenden soll kommen wenn keien fragen mehr geladen werden können
        -->

        <button type="submit" asp-page-handler="CheckAnswer" class="btn btn-primary">
            !Antwort Prüfen
        </button>


        <button type="submit" asp-page-handler="NextQuestion" class="btn btn-success">
            Nächste Frage
        </button>

        <!-- Wenn letzte frage da ist -->
        @if (Model.CurrentOffset == Model.HowManyQuestions())
        {
            <button type="submit" asp-page-handler="FinishQuiz" class="btn btn-danger">
                !Quiz Beenden
            </button>
        }

    </div>
</form>









































<script>
    function selectAnswer(cardElement) {
        const allCheckboxes = document.querySelectorAll('.checkmark');
        const allCards = document.querySelectorAll('.antwort-card');

        allCards.forEach(card => card.classList.remove('selected'));
        allCheckboxes.forEach(cb => cb.checked = false);

        const currentCheckbox = cardElement.querySelector('.checkmark');
        currentCheckbox.checked = true;
        cardElement.classList.add('selected');
    }

    function updateSelection(checkbox) {
        const card = checkbox.closest('.antwort-card');

        if (checkbox.checked) {
            document.querySelectorAll('.checkmark').forEach(cb => {
                if (cb !== checkbox) cb.checked = false;
            });

            document.querySelectorAll('.antwort-card').forEach(c => {
                if (c !== card) c.classList.remove('selected');
            });

            card.classList.add('selected');
        } else {
            card.classList.remove('selected');
        }
    }

    document.querySelectorAll('.checkmark').forEach(cb => {
        cb.addEventListener('click', e => e.stopPropagation());
    });
</script>
